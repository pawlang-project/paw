# LLVM 完整安装脚本使用指南

## 🎯 install_llvm_complete.sh

一键完成所有步骤的完整安装脚本。

### 功能

✅ **步骤 1**: 检测平台（自动识别 OS 和架构）  
✅ **步骤 2**: 下载 LLVM 19.1.7 预编译版本  
✅ **步骤 3**: 解压文件  
✅ **步骤 4**: 安装到 `llvm/install/`  
✅ **步骤 5**: 验证安装  
✅ **步骤 6**: 构建 PawLang（启用 LLVM 支持）  
✅ **测试**: 编译并运行测试程序  

### 支持的平台

- ✅ macOS x86_64 (Intel)
- ✅ macOS arm64 (Apple Silicon M1/M2/M3)
- ✅ Linux x86_64
- ✅ Linux aarch64 (ARM64)

### 使用方法

```bash
# 直接运行
scripts/install_llvm_complete.sh
```

### 功能特点

1. **智能检测**
   - 自动识别操作系统和架构
   - 选择对应的预编译版本

2. **进度显示**
   - 下载进度（使用 wget 或 curl）
   - 步骤提示（6 个主要步骤）
   - 彩色输出（可选）

3. **错误处理**
   - 每步都有验证
   - 失败时显示清晰错误
   - 自动清理临时文件

4. **智能跳过**
   - 检测已有安装
   - 询问是否重新安装
   - 可跳过下载直接构建

### 输出示例

```
╔════════════════════════════════════════════════════════╗
║       PawLang LLVM 完整安装脚本                        ║
║       下载 + 解压 + 安装 + 构建 + 测试                 ║
╚════════════════════════════════════════════════════════╝

项目目录: /Users/xxx/PawLang
LLVM 版本: 19.1.7

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  🔍 步骤 1/6: 检测平台
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
操作系统: Darwin
架构: arm64
✅ 平台: macOS Apple Silicon (M1/M2/M3)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  📥 步骤 2/6: 下载 LLVM 19.1.7
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
文件: clang+llvm-19.1.7-aarch64-apple-darwin.tar.xz
下载大小: ~300-600 MB
预计时间: 5-15 分钟

[下载进度条...]

✅ 下载完成

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  📦 步骤 3/6: 解压文件
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
解压到: llvm/temp
这可能需要几分钟...

✅ 解压完成

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  📂 步骤 4/6: 安装 LLVM
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
源目录: llvm/temp/clang+llvm-19.1.7-aarch64-apple-darwin
目标目录: llvm/install

✅ 安装完成

🧹 清理临时文件...
✅ 清理完成

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ✓ 步骤 5/6: 验证 LLVM 安装
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
LLVM 版本:
clang version 19.1.7
Target: arm64-apple-darwin25.0.0
Thread model: posix

检查关键文件:
  ✓ bin/clang
  ✓ lib/libLLVM.a (或变体)
  ✓ include/llvm-c/Core.h

✅ LLVM 安装验证通过

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  🔨 步骤 6/6: 构建 PawLang
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✓ Local LLVM detected at llvm/install
✅ LLVM native API enabled

✅ PawLang 构建完成

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  🧪 测试 LLVM 后端
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

编译测试程序...
链接可执行文件...
运行测试...

✅ 测试通过！退出码: 42

╔════════════════════════════════════════════════════════╗
║               ✅ 安装完成！                            ║
╚════════════════════════════════════════════════════════╝

📊 安装信息:
  LLVM 版本: 19.1.7
  安装路径: llvm/install
  Clang: llvm/install/bin/clang
  安装大小: 650M

🎯 下一步:
  ...
```

### 依赖要求

**必需**:
- Zig 编译器
- wget 或 curl
- tar
- gcc 或 clang（系统编译器）

**可选**:
- Python 3.6+（如果想使用 Python 版本的下载脚本）

### 预计时间

| 步骤 | 时间 |
|------|------|
| 检测平台 | < 1 秒 |
| 下载 LLVM | 5-15 分钟 |
| 解压文件 | 2-5 分钟 |
| 安装文件 | < 1 分钟 |
| 验证 | < 1 分钟 |
| 构建 PawLang | < 1 分钟 |
| **总计** | **约 10-25 分钟** |

### 磁盘空间

- 下载文件: ~600 MB
- 解压后: ~800 MB
- 临时文件: 自动清理
- **最终占用**: ~650-800 MB

### 故障排查

#### 问题: 找不到 wget 或 curl

**解决**:
```bash
# macOS
brew install wget

# Ubuntu/Debian
sudo apt install wget

# CentOS/RHEL
sudo yum install wget
```

#### 问题: 下载速度慢

**解决**:
- 使用 VPN 或代理
- 或使用 Python 版本: `python3 scripts/download_llvm_prebuilt.py --yes`

#### 问题: 权限错误

**解决**:
```bash
chmod +x scripts/install_llvm_complete.sh
```

#### 问题: 链接失败（找不到 System 库）

**解决**:
- 脚本已自动使用系统 gcc/clang
- 确保安装了 Xcode Command Line Tools (macOS)
- 或安装 build-essential (Linux)

### 与 Python 版本对比

| 特性 | Shell 脚本 | Python 脚本 |
|------|----------|------------|
| 依赖 | wget/curl, tar | Python 3.6+ |
| 进度条 | wget/curl 原生 | 自定义（更美观） |
| 平台检测 | ✅ | ✅ |
| 错误处理 | ✅ | ✅ |
| 一键安装 | ✅ | ❌ (需要额外步骤) |
| 交互确认 | ✅ | ✅ |

**推荐**: 
- 如果有 wget/curl → 使用 Shell 脚本（更简单）
- 如果喜欢 Python → 使用 `download_llvm_prebuilt.py`

### 使用示例

#### 全新安装

```bash
# 一键完成所有步骤
scripts/install_llvm_complete.sh
```

#### 重新安装

如果已有 LLVM，脚本会询问是否重新安装：
```
是否重新安装? (y/N): y
```

#### 跳过安装（仅构建）

如果 LLVM 已安装，选择 N 会跳过下载，直接构建 PawLang。

## 总结

`install_llvm_complete.sh` 是最简单、最快速的 LLVM 安装方式：

- ⚡ 一个命令完成所有步骤
- 📊 清晰的进度显示
- 🛡️ 完整的错误处理
- 🧹 自动清理临时文件
- ✅ 包含测试验证

**推荐给所有用户使用！**

